<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora Apuestas Avanzada • Poisson + Kelly</title>
<style>
:root{--gap:12px;--radius:10px;--bg:#0f1220;--card:#191c2f;--muted:rgba(230,233,245,.75);}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#e6e9f5}
.container{max-width:1100px;margin:24px auto;padding:16px;display:grid;grid-template-columns:1fr;gap:var(--gap)}
.header{text-align:center;padding:12px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.card{background:var(--card);border:1px solid #2a2e4a;padding:14px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(0,0,0,.08)}
label{font-size:13px;opacity:.95}
input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #2a2e4a;background:var(--bg);color:inherit}
.row{display:flex;gap:10px}
.row > *{flex:1}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{text-align:center;padding:10px;border-radius:8px;background:#0f1220;border:1px solid #2a2e4a;transition:0.2s;}
.tile.good{background:#163f13;border-color:#6ee7a1;}
.tile.bad{background:#4f1212;border-color:#f87171;}
.tile.neutral{background:#1e293b;border-color:#93c5fd;}
.small{font-size:12px;color:var(--muted)}
.btn {padding:10px 16px;border-radius:12px;border:none;background:linear-gradient(135deg,#4f46e5,#6366f1);color:#fff;font-weight:600;cursor:pointer;transition:all 0.2s ease-in-out;box-shadow:0 4px 12px rgba(0,0,0,0.25);}
.btn:hover {transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,0.35);}
.btn:active {transform:translateY(1px);box-shadow:0 3px 10px rgba(0,0,0,0.25);}
.sep{height:1px;background:#2a2e4a;margin:10px 0}
.recs{display:grid;gap:8px}
.table-like{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.adv-options{display:none;margin-top:10px}
.show-adv .adv-options{display:block}
@media(max-width:880px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Calculadora Apuestas Avanzada • Poisson + Kelly</h1>
    <p class="small">Introduce estadísticas por equipo (pos., GF/GC local/visitante, forma). La herramienta recomienda mercados y stake según EV + Kelly.</p>
  </div>

  <div class="grid">
    <!-- Banco y parámetros -->
    <div class="card">
      <h3>Banco mensual</h3>
      <div class="table-like">
        <div>
          <label>Banca actual (Q)</label>
          <input id="bankroll" type="number" value="1000" min="0" step="1"/>
        </div>
        <div>
          <label>Guardar banca</label><br/>
          <button id="saveBank" class="btn">Guardar</button>
        </div>
      </div>

      <div class="sep"></div>
      <button id="toggleAdv" class="btn">Opciones avanzadas</button>
      <div class="adv-options">
        <div class="table-like" style="margin-top:8px">
          <div><label>Media liga (goles / partido)</label><input id="leagueAvg" type="number" value="1.35" step="0.01" min="0.01"/></div>
          <div><label>Máx goles (Poisson)</label><input id="maxGoals" type="number" value="8" min="4" step="1"/></div>
        </div>
      </div>

      <div style="margin-top:16px; display:flex; gap:12px; justify-content:center;">
        <button id="recalc" class="btn">Calcular</button>
        <button id="resetAll" class="btn" style="background:linear-gradient(135deg,#ef4444,#f87171);">Resetear</button>
      </div>
    </div>

    <!-- Equipos y estadísticas -->
    <div class="card">
      <h3>Equipos y estadísticas</h3>
      <div class="table-like">
        <div>
          <label>Liga</label>
          <select id="leagueSelect"><option value="">-- Selecciona liga --</option></select>
        </div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>Equipo Local</label><select id="teamHome"></select></div>
        <div><label>Equipo Visitante</label><select id="teamAway"></select></div>
      </div>

      <div class="sep"></div>
      <h4>Posición en la tabla</h4>
      <div class="table-like">
        <div><label>Pos Local</label><input id="posHome" type="number" value="5" min="1"/></div>
        <div><label>Pos Visitante</label><input id="posAway" type="number" value="12" min="1"/></div>
      </div>

      <div class="sep"></div>
      <h4>Promedios por partido</h4>
      <div class="table-like">
        <div><label>GF local</label><input id="gfHome" type="number" value="1.6" step="0.01" min="0"/></div>
        <div><label>GC local</label><input id="gaHome" type="number" value="1.1" step="0.01" min="0"/></div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>GF visitante</label><input id="gfAway" type="number" value="1.4" step="0.01" min="0"/></div>
        <div><label>GC visitante</label><input id="gaAway" type="number" value="1.2" step="0.01" min="0"/></div>
      </div>

      <div class="sep"></div>
      <h4>Forma (últimos 5)</h4>
      <div class="table-like">
        <div><label>Victorias últimas 5 (Local)</label><input id="formHome" type="number" value="3" min="0" max="5"/></div>
        <div><label>Victorias últimas 5 (Visitante)</label><input id="formAway" type="number" value="1" min="0" max="5"/></div>
      </div>
    </div>
  </div>

  <!-- Cuotas y resultados -->
  <div class="grid" style="margin-top:12px;">
    <div class="card">
      <h3>Cuotas</h3>
      <div class="table-like">
        <div><label>1X2 Local</label><input id="oddsHome" type="number" value="2.10" step="0.01" min="1"/></div>
        <div><label>1X2 Empate</label><input id="oddsDraw" type="number" value="3.40" step="0.01" min="1"/></div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>1X2 Visitante</label><input id="oddsAway" type="number" value="3.80" step="0.01" min="1"/></div>
        <div><label>BTTS Sí</label><input id="oddsBTTS" type="number" value="1.90" step="0.01" min="1"/></div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>Over 2.5</label><input id="oddsOver25" type="number" value="2.00" step="0.01" min="1"/></div>
      </div>
    </div>

    <div class="card">
      <h3>Resultados & Recomendaciones</h3>
      <div class="kpis">
        <div class="tile neutral"><strong id="pHome">—</strong><div class="small">Prob. Local</div></div>
        <div class="tile neutral"><strong id="pDraw">—</strong><div class="small">Prob. Empate</div></div>
        <div class="tile neutral"><strong id="pAway">—</strong><div class="small">Prob. Visitante</div></div>
        <div class="tile neutral"><strong id="pBTTS">—</strong><div class="small">Prob. BTTS</div></div>
        <div class="tile neutral"><strong id="pO25">—</strong><div class="small">Prob. Over 2.5</div></div>
        <div class="tile neutral"><strong id="expectedBest">—</strong><div class="small">Mejor EV</div></div>
      </div>
      <div class="sep"></div>
      <div id="details" class="recs small"></div>
    </div>
  </div>
</div>

<script>
// ---------------- Utilidades ----------------
const $ = id => document.getElementById(id);
const formatPct = x => (100*x).toFixed(1) + '%';
const parseNum = v => parseFloat(String(v||'').replace(/,/g,'.'))||0;

// Toggle opciones avanzadas
document.getElementById('toggleAdv').addEventListener('click',()=>{
  document.querySelector('.card .adv-options').classList.toggle('show-adv');
});

// Guardar banca
$('saveBank').addEventListener('click',()=>{
  localStorage.setItem('bankroll', $('bankroll').value);
  alert('Banca guardada!');
});

// Resetear todo
$('resetAll').addEventListener('click',()=>{
  if(confirm('¿Deseas resetear todos los valores y banca?')){
    localStorage.removeItem('bankroll');
    document.querySelectorAll('input').forEach(i=>i.value='');
    document.querySelectorAll('select').forEach(s=>s.selectedIndex=0);
    ['pHome','pDraw','pAway','pBTTS','pO25','expectedBest','details'].forEach(id=>$$(id).textContent='—');
  }
});

// Aquí irían tus funciones: logFactorial, poissonPMF, computeLambdas, compute1X2, computeBTTS, expectedValue, kellyFraction, gatherInputs, calculateAll, renderRecommendations
</script>
</body>
</html>
