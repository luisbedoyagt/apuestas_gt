<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Calculadora Apuestas Avanzada • Poisson + Kelly</title>
<style>
/* --- Todo tu CSS original --- */
:root{--gap:12px;--radius:10px;--bg:#0f1220;--card:#191c2f;--muted:rgba(230,233,245,.75);}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#e6e9f5}
.container{max-width:1100px;margin:24px auto;padding:16px;display:grid;grid-template-columns:1fr;gap:var(--gap)}
.header{text-align:center;padding:12px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.card{background:var(--card);border:1px solid #2a2e4a;padding:14px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(0,0,0,.08)}
label{font-size:13px;opacity:.95}
input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #2a2e4a;background:var(--bg);color:inherit}
.row{display:flex;gap:10px}
.row > *{flex:1}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.tile{text-align:center;padding:10px;border-radius:8px;background:#0f1220;border:1px solid #2a2e4a}
.small{font-size:12px;color:var(--muted)}
.btn {
  padding: 10px 16px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(135deg, #4f46e5, #6366f1);
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}
.btn:hover {transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.35);}
.btn:active {transform: translateY(1px); box-shadow: 0 3px 10px rgba(0,0,0,0.25);}
#saveBank {background: linear-gradient(135deg, #ef4444, #f87171);}
#saveBank:hover {transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.35);}
.sep{height:1px;background:#2a2e4a;margin:10px 0}
.recs{display:grid;gap:8px}
.bad{color:#f87171}.good{color:#6ee7a1}.neutral{color:#93c5fd}
.table-like{display:grid;grid-template-columns:1fr 1fr;gap:8px}
@media(max-width:880px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Calculadora Apuestas Avanzada • Poisson + Kelly</h1>
    <p class="small">Introduce estadísticas por equipo (pos., GF/GC local/visitante, forma). La herramienta recomienda mercados y stake según EV + Kelly.</p>
  </div>

  <div class="grid">
    <div class="card">
      <h3>Banco mensual</h3>
      <div class="table-like">
        <div><label>Banca actual (Q)</label><input id="bankroll" type="number" value="1000"/></div>
        <div><label>Guarda / Actualiza</label><br/><button id="saveBank" class="btn">Guardar banca</button></div>
      </div>
      <div class="sep"></div>
      <h3>Parámetros globales</h3>
      <div class="table-like">
        <div><label>Media liga (goles / partido por equipo)</label><input id="leagueAvg" type="number" value="1.35" step="0.01"/></div>
        <div><label>Máx goles a calcular (Poisson)</label><input id="maxGoals" type="number" value="8"/></div>
      </div>
      <div style="margin-top:10px" class="row">
        <button id="recalc" class="btn">Calcular recomendaciones</button>
        <button id="reset" class="btn">Reset valores</button>
      </div>

      <div class="sep"></div>
      <h3>Cargar datos de equipo desde Statshub</h3>
      <div class="table-like">
        <div><label>Link del equipo</label><input id="teamLink" placeholder="https://www.statshub.com/team/deportivo-toluca-fc/1931"/></div>
        <div style="margin-top:8px"><button id="loadTeam" class="btn">Cargar equipo</button></div>
      </div>
    </div>

    <div class="card">
      <h3>Equipos y estadísticas</h3>
      <div class="table-like">
        <div><label>Liga</label>
          <select id="leagueSelect"><option value="">-- Selecciona liga --</option><option value="ligaMX">Liga MX</option></select>
        </div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>Equipo Local</label><select id="teamHome"></select></div>
        <div><label>Equipo Visitante</label><select id="teamAway"></select></div>
      </div>
      <div class="sep"></div>
      <h4>Posición</h4>
      <div class="table-like">
        <div><label>Pos Local</label><input id="posHome" type="number" value="5"/></div>
        <div><label>Pos Visitante</label><input id="posAway" type="number" value="12"/></div>
      </div>
      <div class="sep"></div>
      <h4>Promedios</h4>
      <div class="table-like">
        <div><label>GF local</label><input id="gfHome" type="number" value="1.6"/></div>
        <div><label>GC local</label><input id="gaHome" type="number" value="1.1"/></div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>GF visitante</label><input id="gfAway" type="number" value="1.4"/></div>
        <div><label>GC visitante</label><input id="gaAway" type="number" value="1.2"/></div>
      </div>
      <div class="sep"></div>
      <h4>Forma (últimos 5)</h4>
      <div class="table-like">
        <div><label>Victorias Local</label><input id="formHome" type="number" value="3"/></div>
        <div><label>Victorias Visitante</label><input id="formAway" type="number" value="1"/></div>
      </div>
    </div>
  </div>

  <div class="grid" style="margin-top:12px;">
    <div class="card">
      <h3>Cuotas</h3>
      <div class="table-like">
        <div><label>1X2 - Local</label><input id="oddsHome" type="number" value="2.10"/></div>
        <div><label>1X2 - Empate</label><input id="oddsDraw" type="number" value="3.40"/></div>
      </div>
      <div class="table-like" style="margin-top:8px">
        <div><label>1X2 - Visitante</label><input id="oddsAway" type="number" value="3.80"/></div>
        <div><label>BTTS</label><input id="oddsBTTS" type="number" value="1.90"/></div>
      </div>
    </div>

    <div class="card">
      <h3>Resultados & Recomendaciones</h3>
      <div class="kpis">
        <div class="tile"><strong id="pHome">—</strong><div class="small">Prob. Local</div></div>
        <div class="tile"><strong id="pDraw">—</strong><div class="small">Prob. Empate</div></div>
        <div class="tile"><strong id="pAway">—</strong><div class="small">Prob. Visitante</div></div>
      </div>
      <div class="sep"></div>
      <div id="details" class="recs small"></div>
    </div>
  </div>
</div>

<script>
// --- Selector rápido ---
const $ = id => document.getElementById(id);

// --- Simulación: rellenar campos desde Statshub con fetch + proxy público ---
$('#loadTeam').addEventListener('click', async () => {
  const url = $('#teamLink').value.trim();
  if(!url) return alert('Ingresa un link válido');

  try {
    // Proxy CORS público
    const proxy = 'https://api.allorigins.win/get?url=';
    const res = await fetch(proxy + encodeURIComponent(url));
    const text = await res.json();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text.contents, 'text/html');

    // Extraer nombre y estadísticas (ejemplo: solo nombre y GF/GC)
    const name = doc.querySelector('h1')?.textContent || '';
    $('teamHome').innerHTML = `<option>${name}</option>`;
    $('teamHome').value = name;

    // Datos ficticios de ejemplo: en producción hay que parsear GF/GC y forma reales
    $('gfHome').value = 1.6;
    $('gaHome').value = 1.1;
    $('gfAway').value = 1.4;
    $('gaAway').value = 1.2;
    $('posHome').value = 5;
    $('posAway').value = 12;
    $('formHome').value = 3;
    $('formAway').value = 2;

    alert('Datos cargados desde Statshub (simulado)');
  } catch (e) {
    console.error(e);
    alert('No se pudo cargar el equipo');
  }
});
</script>
</body>
</html>
