<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Calculadora Fútbol: Goles, Corners y Tarjetas</title>
<style>
:root { --gap: 12px; --radius: 12px; --shadow: 0 6px 18px rgba(0,0,0,.08); }
* { box-sizing: border-box; }
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; margin:0; background:#0f1220; color:#e6e9f5; }
header { padding: 24px; text-align:center; }
header h1{ margin:0 0 6px; font-size: clamp(20px, 3vw, 28px); }
header p { margin:0; opacity:.8; font-size: 14px; }
main { max-width: 1100px; margin: 0 auto; padding: 18px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--gap); }
section, .card { background: #191c2f; border: 1px solid #2a2e4a; border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
h2 { font-size: 16px; margin: 0 0 10px; letter-spacing: .3px; }
.grid { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
label { font-size: 12px; opacity:.9; }
input, select { width: 100%; padding: 10px; border-radius: 10px; background:#0f1220; border:1px solid #2a2e4a; color:#e6e9f5; }
input[type="number"] { appearance: textfield; }
.row { display:flex; gap:10px; }
.row > * { flex:1; }
.muted { opacity:.75; font-size:12px; }
.kpi { display:grid; grid-template-columns: repeat(2,1fr); gap: 10px; }
.kpi .tile { background:#0f1220; border:1px solid #2a2e4a; padding:12px; border-radius:10px; text-align:center; }
.tile h3 { margin:0; font-size: 22px; }
.tile p { margin:6px 0 0; opacity:.8; font-size:12px; }
.good { color: #6ee7a1; }
.bad { color: #f87171; }
.neutral { color: #93c5fd; }
.btn { padding:10px 14px; border-radius:10px; border:1px solid #2a2e4a; background:#0f1220; color:#e6e9f5; cursor:pointer; }
.btn:hover { filter: brightness(1.1); }
.footer { max-width:1100px; margin:0 auto 24px; padding:0 18px; opacity:.7; font-size:12px; }
.code { background:#0f1220; border:1px solid #2a2e4a; padding:2px 6px; border-radius:6px; }
.sep { height:1px; background:#2a2e4a; margin: 12px 0; }
</style>
</head>
<body>
<header>
<h1>Calculadora Fútbol: Goles, Corners y Tarjetas</h1>
<p>Introduce los promedios y cuotas. Calculamos probabilidades y Kelly automáticamente usando Poisson.</p>
</header>

<main>
<section aria-labelledby="in1">
<h2 id="in1">Datos del partido</h2>
<div class="grid">
  <div><label>Equipo A GF</label><input id="gfA" type="number" step="0.01" min="0" value="1.6"></div>
  <div><label>Equipo A GC</label><input id="gaA" type="number" step="0.01" min="0" value="1.1"></div>
  <div><label>Equipo B GF</label><input id="gfB" type="number" step="0.01" min="0" value="1.4"></div>
  <div><label>Equipo B GC</label><input id="gaB" type="number" step="0.01" min="0" value="1.2"></div>
  <div><label>Media liga (goles/partido)</label><input id="leagueAvg" type="number" step="0.01" min="0.1" value="1.35"></div>
  <div><label>Media liga (corners/partido)</label><input id="leagueCorners" type="number" step="0.01" min="0.1" value="9.5"></div>
  <div><label>Media liga (tarjetas/partido)</label><input id="leagueCards" type="number" step="0.01" min="0.1" value="3.5"></div>
</div>
<div class="row">
  <button class="btn" id="recalc">Recalcular λ</button>
  <button class="btn" id="reset">Reset</button>
</div>
</section>

<section aria-labelledby="in2">
<h2 id="in2">Cuotas y banca</h2>
<div class="grid">
  <div><label>Formato de cuotas</label><select id="oddsFmt"><option value="decimal" selected>Decimal</option><option value="american">Americano</option></select></div>
  <div><label>Banca disponible</label><input id="bankroll" type="number" step="1" min="0" value="1000"></div>
  <div><label>BTTS Sí • Cuota</label><input id="oddsBTTS" type="number" step="0.01" min="1.01" value="1.90"></div>
  <div><label>Over 2.5 • Cuota</label><input id="oddsOver25" type="number" step="0.01" min="1.01" value="2.00"></div>
  <div><label>Over 9.5 corners • Cuota</label><input id="oddsOverCorners" type="number" step="0.01" min="1.01" value="1.85"></div>
  <div><label>Over 3.5 tarjetas • Cuota</label><input id="oddsOverCards" type="number" step="0.01" min="1.01" value="2.10"></div>
</div>
</section>

<section aria-labelledby="out">
<h2 id="out">Resultados del modelo</h2>
<div class="kpi">
  <div class="tile"><h3 id="pBTTS">—</h3><p>Prob. BTTS Sí</p></div>
  <div class="tile"><h3 id="pO25">—</h3><p>Prob. Over 2.5</p></div>
  <div class="tile"><h3 id="pCorners">—</h3><p>Prob. Over 9.5 corners</p></div>
  <div class="tile"><h3 id="pCards">—</h3><p>Prob. Over 3.5 tarjetas</p></div>
  <div class="tile"><h3 id="kellyBTTS">—</h3><p>Kelly BTTS</p></div>
  <div class="tile"><h3 id="kellyO25">—</h3><p>Kelly Over 2.5</p></div>
  <div class="tile"><h3 id="kellyCorners">—</h3><p>Kelly Corners</p></div>
  <div class="tile"><h3 id="kellyCards">—</h3><p>Kelly Tarjetas</p></div>
</div>
</section>
</main>

<div class="footer">
<p>Modelo didáctico. No garantiza resultados. Respeta gestión de riesgo.</p>
</div>

<script>
const $ = id=>document.getElementById(id);
const formatPct=x=> (100*x).toFixed(1)+'%';
const formatMoney=x=> 'Q '+x.toFixed(2);

function toDecimalOdds(value,fmt){if(fmt==='decimal') return Math.max(parseFloat(value||0),1.000001);const a=parseFloat(value||0); if(isNaN(a)) return 1.0; return a>0 ? 1+a/100 : 1+100/Math.abs(a);}
function poissonPMF(k,lambda){if(lambda<=0) return k===0?1:0; let logP=-lambda+k*Math.log(lambda)-logFactorial(k); return Math.exp(logP);}
const factCache=[0,0];
function logFactorial(n){if(n<2) return 0; if(factCache[n]) return factCache[n]; let sum=0; for(let i=2;i<=n;i++) sum+=Math.log(i); factCache[n]=sum; return sum;}
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}

// RECALCULO λ AUTOMATICO
function recalcLambda(){
  const gfA=parseFloat($('gfA').value), gaA=parseFloat($('gaA').value);
  const gfB=parseFloat($('gfB').value), gaB=parseFloat($('gaB').value);
  const L=parseFloat($('leagueAvg').value);
  const LC=parseFloat($('leagueCorners').value);
  const LCard=parseFloat($('leagueCards').value);

  // λ goles
  const h=Math.max(0.5,gfA/L);
  const lambdaA=Math.max(0,(gfA*gaB/L)*h);
  const lambdaB=Math.max(0,(gfB*gaA/L));

  $('lambdaA').value=lambdaA.toFixed(2);
  $('lambdaB').value=lambdaB.toFixed(2);

  // λ corners y tarjetas
  const lambdaCornersA=(gfA*gaB/L)*LC/L; 
  const lambdaCornersB=(gfB*gaA/L)*LC/L;
  const lambdaCardsA=(gfA*gaB/L)*LCard/L; 
  const lambdaCardsB=(gfB*gaA/L)*LCard/L;

  recompute(lambdaA,lambdaB,lambdaCornersA+lambdaCornersB,lambdaCardsA+lambdaCardsB);
}

// RECALCULO PRINCIPAL
function recompute(lA,lB,lCorners,lCards){
  lA=lA||parseFloat($('lambdaA').value||0);
  lB=lB||parseFloat($('lambdaB').value||0);
  lCorners=lCorners||10; 
  lCards=lCards||3;

  const fmt=$('oddsFmt').value;
  const oddsBTTS=toDecimalOdds($('oddsBTTS').value,fmt);
  const oddsO25=toDecimalOdds($('oddsOver25').value,fmt);
  const oddsCorners=toDecimalOdds($('oddsOverCorners').value,fmt);
  const oddsCards=toDecimalOdds($('oddsOverCards').value,fmt);

  // Probabilidades
  const pBTTS=1-Math.exp(-lA)-Math.exp(-lB)+Math.exp(-(lA+lB));
  const lT=lA+lB;
  const pOver25=1-(poissonPMF(0,lT)+poissonPMF(1,lT)+poissonPMF(2,lT));
  const pOverCorners=1-(poissonPMF(0,lCorners)+poissonPMF(1,lCorners)+poissonPMF(2,lCorners)+poissonPMF(3,lCorners)+poissonPMF(4,lCorners)+poissonPMF(5,lCorners)+poissonPMF(6,lCorners)+poissonPMF(7,lCorners)+poissonPMF(8,lCorners)+poissonPMF(9,lCorners));
  const pOverCards=1-(poissonPMF(0,lCards)+poissonPMF(1,lCards)+poissonPMF(2,lCards)+poissonPMF(3,lCards));

  function kelly(p,odds){const b=odds-1;return clamp((b*p-(1-p))/b,0,1);}
  const bank=parseFloat($('bankroll').value||0);
  const kBTTS=kelly(pBTTS,oddsBTTS), kO25=kelly(pOver25,oddsO25), kCorners=kelly(pOverCorners,oddsCorners), kCards=kelly(pOverCards,oddsCards);

  $('pBTTS').textContent=formatPct(pBTTS);
  $('pO25').textContent=formatPct(pOver25);
  $('pCorners').textContent=formatPct(pOverCorners);
  $('pCards').textContent=formatPct(pOverCards);

  $('kellyBTTS').textContent=(kBTTS*100).toFixed(1)+'% ('+formatMoney(bank*kBTTS)+')';
  $('kellyO25').textContent=(kO25*100).toFixed(1)+'% ('+formatMoney(bank*kO25)+')';
  $('kellyCorners').textContent=(kCorners*100).toFixed(1)+'% ('+formatMoney(bank*kCorners)+')';
  $('kellyCards').textContent=(kCards*100).toFixed(1)+'% ('+formatMoney(bank*kCards)+')';
}

// EVENTOS
document.addEventListener('input',()=>recalcLambda());
$('recalc').addEventListener('click',recalcLambda);
$('reset').addEventListener('click',()=>document.querySelectorAll('input').forEach(i=>i.value=i.defaultValue));
recalcLambda();
</script>
</body>
</html>

